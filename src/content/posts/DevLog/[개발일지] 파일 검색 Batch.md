---
title: "[개발일지] Directory SCAN"
published: 2024-06-28
description: ''
image: ''
tags: [Window, Batch, 개발일지]
category: '개발일지'
draft: false 
---
# 사건발단
어느날 회사에서 "개인정보가 있는 파일을 검색하고 싶다."라는 요청이 있었다. 폐쇄적인 구조의 네트워크를 활용할 수 없는 상황이였고, 
솔루션을 사용하고 있었지만, image, pdf 확장자 파일은 해당 솔루션에 검색되지 않았다.
![Alt text](./mem/pls-goat.gif)

# 문제제시
처음엔 직원들이 모든 PC에 가서 2가지 아이디어를 제시했다.
1. Everything을 설치해서 검색하자.
2. 윈도우 탐색기로 최대 5가지의 키워드를 정해서 검색하자.

[Everything](https://www.voidtools.com/ko-kr/)은 실시간으로 파일이 검색되는 Tool이다. 사실 엄청나게 폐쇄적인 기관은 아니지만,
그래도 정보보안에 항상 유의를 해야하기 때문에 Open Soure나 무료로 배포되는 Tool에 대해서 어느정도 경계하였다. 또한, 개인 PC에 해당 Tool을 설치하는 것을
안좋아하는 분들도 있을 수 있었다.

그래도 해당 고민을 이겨내고 Everything 툴을 사용해서 한다면 문제가 안생겼겠지만, 2번인 윈도우 탐색기로 키워드 5가지를 정해서 돌리자는 의사결정을 했다.
그래서 나는 고민을 했다.

"10개의 팀으로 팀당 1명씩 윈도우 탐색기를 활용해서 5개의 키워드를 검색하고 그것도 1개의 PC에 앉아서 해야한다면, 더 효율적인 방법이 없을까?"

일단 우리팀은 총 4명이 그 검색을 해야했고, 한명만 개인정보인지 아닌지 판단할 수 있는 역량을 갖고 있었기 때문에 윈도우 탐색기를 활용하는 방법은 비효율적이라고 생각되었다.

윈도우 탐색기를 통해서 검색하는 방법의 몇가지 문제점을 찾았다.
1. 진짜 못해도 문서를 10GB이상 갖고 있으며, 직원들은 문서 제목의 길게 저장한다. 즉, 오래걸린다는 것이다. (ex. 찐막막막막막막막막막막막막막막막막막막막 제안서)
2. PC를 검색하는 동안, 해당 PC를 직원이 사용을 못해 컴플레인이 걸릴 것이다.
3. 드라이브가 2개이상이기 때문에 5개의 키워드를 검색하려면 (드라이브 갯수 X 키워드 갯수) 만큼 검색해야한다.
4. 5개의 키워드로 "개인정보 파일"을 검색할 수 있을까? 키워드를 더 추가하면 좋을거 같다.

# 해결방안
![Alt text](./mem/scanner-red-light-green-light.gif)
일단, 퇴근을 고사하고 비효율적인걸 상당히 싫어하는 입장으로 조금 더 합리적으로 작업을 수행하고 싶었다. 그래서 먼저 환경적인 요인과 필요한 사항들을
생각했다.

1. Tool 사용 불가
2. Window PC 사용
3. 키워드 5개 이상 검색
4. 드라이브 갯수 2개 이상

일단, Window PC .bat 확장자를 사용해서 스크립트를 작성할 수 있다. 그리고 어느정도 파일을 검색할때 CMD를 사용할 줄 알아서 .bat 확장자를 
활용하여 스크립트 작성했다.

1. 키워드를 넣는다.
2. 드라이브를 검색한다.
3. 드라이브마다 하나씩 키워드를 검색한다.
4. 검색 내역을 콘솔창과 pr.log에 저장한다.

위의 과정대로 스크립트를 작성했고 아래가 작성된 스크립트이다.

<html><script src="https://gist.github.com/black9769/8edb4cef62603588751f7182ed5f38a3.js"></script></html>

## 상세설명
패턴에는 ","없이 구분자로 공백 문자만 넣어주면된다.
```
set "patterns= log 비밀번호 여권"
```
# 결말
내가 작성한 스크립트 덕분에 3시간~4시간 걸릴 것들이 1시간안에 처리될 수 있었다. 정보보안을 담당하는 직원도 우리 팀원들도 대상 PC에 붙어서
시간을 낭비하지 않고 나는 설치후에 콘솔에 나오는 경로를 통해서 "개인정보"파일인지 아닌지 실시간으로 처리했다.

하지만, 몇가지 아쉬운점이 있었다.
1. 예외처리: 대상 PC의 사용자가 Process가 해당 디렉토리를 탐색할때 같이 윈도우 탐색기를 돌릴때 Process가 중단된다.
2. 실행시간예측불가: 대상 PC마다 파일을 갖고있는 양이 달랐기 때문에 오래걸리는 것은 40분 이상 걸렸다. 또한, PC성능에 따라 달랐다.
3. 네트워크 활용불가: 사실 같은 IP대역 이기 때문에 그 IP 대역의 PC에 들어가서 SCAN을 하면 좋았을텐데, 보안 위배사항이였다.

아쉬운점 1번은 고칠수 있는 방법에 대해서 고민해봐야될거 같다. 윈도우탐색기 자체를 Process가 실행하는 동안 실행되지 못하게 할 수 있지 않을까?

